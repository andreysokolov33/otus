# Настройка AS 65000

1. Настройка OSPF
2. Настройка iBGP
3. Настройка eBGP
4. Настройка политик eBGP
5. Настройка ECMP на каждой AREA и на провайдеров
6. PBR
7. EtherChannel
8. DHCP
9. NTP

## Настройка OSPF

На всех маршрутизаторах настраивается OSPF, тип сети Point-to-Point.

### CORE_1

```bash
interface range e0/0-3,e1/0-2
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### CORE_2

```bash
interface range e0/0-3,e1/0-2
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### Technical

```bash
interface range e0/0-1
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### Server_1

```bash
interface e0/0
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### Server_2

```bash
interface e0/0
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### GW_1

```bash
interface range e0/0-1
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area 0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### GW_2

```bash
interface range e0/0-1
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area 0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### Management_1

```bash
interface e0/0
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0
 
router ospf 1
 auto-cost reference-bandwidth 10000
```

### Management_2

```bash
interface e0/0
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0

router ospf 1
 auto-cost reference-bandwidth 10000
```

### Director

```bash
interface range e0/0-1б
 ip ospf network point-to-point
 ip ospf 1 area 0

interface lo1
 ip ospf 1 area0

router ospf 1
 auto-cost reference-bandwidth 10000
```

Таблица с соседством на CORE_1

![Alt text](/Практическая%20работа/images/msk-core1-sh-ip-ospf-neigh.png)

Полученные по OSPF маршруты на CORE_1

![Alt text](/Практическая%20работа/images/msk-core1-sh-ip-route-ospf.png)

## Настройка устройств Gateways (GW1 и GW2)

### Etherchannel между GW1 и GW2

Между GW1 и GW2 на интерфейсах e0/2-3,e1/0 будет организован агрегированный канал по протоколу LACP в режиме active

GW1

```bash
interface range e0/2-3,e1/0
 no switchport
 channel-group 10 mode active

interface po10
 ip address 10.0.0.37 255.255.255.252
```

GW1

```bash
interface range e0/2-3,e1/0
 no switchport
 channel-group 10 mode active

interface po10
 ip address 10.0.0.38 255.255.255.252
```

В результате агрегированный канал поднялся, оба устройства могут пингануть адрес агрегированного канала соседа:

![Alt text](/Практическая%20работа/images/gw1-show-etherchannel-summary.png)

![Alt text](/Практическая%20работа/images/gw1-ping-etherchannel-gw2.png)

### Настройка BGP

GW1

```bash
router bgp 65000
 neighbor 10.2.0.7 remote-as 65000
 neighbor 10.2.0.7 update-source loopback 1
 neighbor 10.2.0.7 next-hop-self
 neighbor 185.10.20.2 remote-as 520
 neighbor 185.10.20.6 remote-as 101
```

GW2

```bash
router bgp 65000
 neighbor 10.2.0.6 remote-as 65000
 neighbor 10.2.0.6 update-source loopback 1
 neighbor 10.2.0.6 next-hop-self
 neighbor 185.10.20.10 remote-as 520
 neighbor 185.10.20.14 remote-as 101
```

Соседство установлено

GW1:

![Alt text](/Практическая%20работа/images/gw1-show-ip-bgp-sum-1.png)

GW2:

![Alt text](/Практическая%20работа/images/gw2-show-ip-bgp-sum-1.png)
